<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preact Chess & Chat App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Global body styles */
        body { 
            font-family: 'Inter', sans-serif; 
            overscroll-behavior: none; 
            margin: 0; 
            background-color: #111827; /* Tailwind gray-900 */
            color: #f3f4f6; /* Tailwind gray-100 */
        }

        /* --- Chessboard Component Styles (Consolidated) --- */
        /* These styles are intended for elements rendered by ChessboardComponent.js */
        .board-container { display: flex; flex-direction: column; justify-content: center; align-items: center; box-sizing: border-box; padding: 1rem; }
        .chessboard { display: grid; grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr); width: 100%; /* Takes width of its direct parent */ max-width: 560px; /* Max physical size */ height: auto; aspect-ratio: 1 / 1; border: 4px solid #1e1f22; border-radius: 6px; box-shadow: 0 8px 16px rgba(0,0,0,0.25); position: relative; }
        .square { display: flex; justify-content: center; align-items: center; font-size: clamp(20px, 5vw, 48px); user-select: none; position: relative; cursor: pointer; overflow: hidden; }
        .square[draggable="true"] { cursor: grab; }
        .square[draggable="true"]:active { cursor: grabbing; }
        .light { background-color: #f0d9b5; } 
        .dark { background-color: #b58863; }
        .piece { pointer-events: none; line-height: 1; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; }
        .piece-white { color: #f8f8f8; text-shadow: 0 0 3px rgba(0,0,0,0.7); } 
        .piece-black { color: #282828; text-shadow: 0 0 3px rgba(255,255,255,0.5); }
        .board-wrapper { position: relative; display: flex; justify-content: center; align-items: center; width: 100%; margin-bottom: 15px; }
        .rank-labels, .file-labels { display: flex; font-family: 'Inter', sans-serif; color: #a0a0a0; font-size: clamp(9px, 1.5vw, 12px); font-weight: 600; position: absolute; }
        .rank-labels { flex-direction: column; left: -22px; top: 0; height: 100%; justify-content: space-around; padding-right: 4px; }
        .file-labels { flex-direction: row; bottom: -22px; left: 0; width: 100%; justify-content: space-around; padding-top: 4px; }
        .rank-labels span, .file-labels span { display: flex; align-items: center; justify-content: center; width: 18px; height: 100%; }
        .file-labels span { height: 18px; width: 100%; }
        .selected-square { background-color: rgba(116, 163, 96, 0.7) !important; outline: 2px solid #5a804a; }
        .legal-move-highlight { box-shadow: inset 0 0 0 3px rgba(80, 130, 200, 0.6); }
        .active-piece-dot::before { content: ''; position: absolute; bottom: 4px; right: 4px; width: 10px; height: 10px; border-radius: 50%; pointer-events: none; z-index: 25; border: 1px solid rgba(0,0,0,0.2); }
        .dot-best::before { background-color: rgba(52, 152, 219, 0.95); } 
        .dot-good::before { background-color: rgba(39, 174, 96, 0.9); }
        .dot-neutral::before { background-color: rgba(144, 238, 144, 0.85); } 
        .dot-bad::before { background-color: rgba(241, 196, 15, 0.9); }
        .dot-blunder::before { background-color: rgba(231, 76, 60, 0.9); } 
        .dot-mate-positive::before { background-color: rgba(41, 128, 185, 0.95); }
        .dot-mate-negative::before { background-color: rgba(192, 57, 43, 0.95); }
        .status-message { margin-top: 10px; padding: 8px 12px; background-color: #374151; /* Tailwind gray-700 */ color: #e0e0e0; border-radius: 5px; font-size: clamp(0.8em, 2vw, 0.9em); min-height: 36px; text-align: center; width: 100%; max-width: 560px; box-sizing: border-box; line-height: 1.4; }
        .error-message { background-color: #d9534f; color: white; }
        .evaluation-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); min-width: 60%; max-width: 90%; padding: 2px 4px; font-size: clamp(10px, 2.2vw, 14px); font-weight: bold; color: white; text-align: center; opacity: 0.9; border-radius: 4px; box-sizing: border-box; line-height: 1.2; pointer-events: none; z-index: 20; white-space: nowrap; }
        .eval-text-best { background-color: rgba(52, 152, 219, 0.8); }
        .eval-text-good { background-color: rgba(39, 174, 96, 0.75); }
        .eval-text-neutral { background-color: rgba(144, 238, 144, 0.7); } 
        .eval-text-bad { background-color: rgba(241, 196, 15, 0.75); }
        .eval-text-blunder { background-color: rgba(231, 76, 60, 0.8); } 
        .eval-text-mate-positive { background-color: rgba(41, 128, 185, 0.85); }
        .eval-text-mate-negative { background-color: rgba(192, 57, 43, 0.9); }

        /* --- Advantage Bar (Horizontal) --- */
        .eval-bar-row { display: flex; align-items: center; gap: 8px; width: 100%; max-width: 560px; margin: 6px 0 0 0; }
        .advantage-bar-h { position: relative; height: 24px; flex: 1; border: 2px solid #1e1f22; border-radius: 6px; overflow: hidden; background: #111827; }
        .advantage-bar-value { font-weight: 700; font-size: 12px; color: #e5e7eb; text-shadow: 0 1px 2px rgba(0,0,0,0.35); min-width: 34px; text-align: right; }
        .adv-h-inner { position: absolute; inset: 0; }
        .adv-h-left { position: absolute; left: 0; top: 0; bottom: 0; background: #0b0b0b; }
        .adv-h-right { position: absolute; right: 0; top: 0; bottom: 0; background: #f9fafb; }

        /* Force-hide any legacy-injected New Game button */
        #new-game-button { display: none !important; visibility: hidden !important; }

        /* --- ChatMessage Component Styles (Consolidated) --- */
        /* These styles are intended for elements rendered by ChatMessageComponent.js */
        /* Custom scrollbar for chat messages container (assuming its ID is 'chat-messages-preact' inside the component) */
        #chat-messages-preact::-webkit-scrollbar { width: 8px; }
        #chat-messages-preact::-webkit-scrollbar-track { background: #1f2937; /* Tailwind gray-800 for chat messages container */ }
        #chat-messages-preact::-webkit-scrollbar-thumb { background-color: #4b5563; /* Tailwind gray-600 */ border-radius: 4px; border: 2px solid #1f2937; }
        
        .user-message { background-color: #3b82f6; /* Tailwind blue-500 */ color: white; align-self: flex-end; }
        .llm-message { background-color: #374151; /* Tailwind gray-700 for chat messages */ color: white; align-self: flex-start; }
        .message-bubble { padding: 0.5rem 0.75rem; border-radius: 0.75rem; max-width: 85%; word-wrap: break-word; box-shadow: 0 1px 3px rgba(0,0,0,0.1); line-height: 1.4; }
        
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <div id="appRoot" class="flex flex-col md:flex-row w-screen h-screen overflow-hidden">
        <p class="text-white text-xl p-10">Loading Chess & Chat App...</p>
    </div>
    <script>
      // Guard: remove any legacy-injected buttons labeled exactly "New Game"
      (function () {
        function scrub() {
          try {
            document.querySelectorAll('#new-game-button').forEach(el => el.remove());
            const all = document.querySelectorAll('button, [role="button"], .btn, .button, a, div');
            all.forEach(el => {
              const txt = (el.textContent || el.innerText || '').trim().toLowerCase();
              if (txt && txt === 'new game') el.remove();
            });
          } catch (_) {}
        }
        scrub();
        try {
          new MutationObserver(scrub).observe(document.documentElement, { childList: true, subtree: true });
        } catch (_) {}
        window.addEventListener('DOMContentLoaded', scrub);
      })();
    </script>
    <script type="module" src="./main.js?v=ui-fix-1"></script>
</body>
</html>
